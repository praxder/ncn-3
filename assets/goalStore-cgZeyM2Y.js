import{r as g,j as d}from"./index-CNoY_Her.js";import{c as x,u as c}from"./store-CUCRhUuB.js";function w({open:t,goalName:e,onConfirm:r,onCancel:s}){const[n,o]=g.useState("");if(!t)return null;const a=i=>{i.preventDefault(),r(n.trim()),o("")};return d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm",children:d.jsxs("form",{onSubmit:a,className:"w-full max-w-md space-y-4 rounded-2xl border border-slate-800 bg-slate-900 p-6 shadow-2xl",children:[d.jsx("h2",{className:"text-lg font-semibold text-slate-100",children:"Reset contributions"}),d.jsxs("p",{className:"text-sm text-slate-400",children:["This will remove all logged contributions for ",d.jsx("span",{className:"font-medium text-white",children:e}),". Export your data first if you need a backup."]}),d.jsxs("label",{className:"space-y-2 text-sm text-slate-200",children:["Reason (optional)",d.jsx("input",{type:"text",value:n,onChange:i=>o(i.target.value),placeholder:"Explain why you are resetting",className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-slate-100 focus:border-brand-primary focus:outline-none"})]}),d.jsxs("div",{className:"flex justify-end gap-3",children:[d.jsx("button",{type:"button",onClick:s,className:"rounded-lg border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-800",children:"Cancel"}),d.jsx("button",{type:"submit",className:"rounded-lg bg-rose-500 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-rose-500/40 hover:translate-y-0.5",children:"Reset contributions"})]})]})})}function p(t,e){const r=e.reduce((o,a)=>o+a.amount,0),s=t.targetAmount>0?r/t.targetAmount*100:0,n=Math.min(100,Math.round(s));return{totalContributed:r,percentage:n}}function A(t){return[...t].sort((e,r)=>new Date(r.date).getTime()-new Date(e.date).getTime())}function f(t,e){return t.filter(r=>r.goalId===e)}const l=()=>new Date().toISOString(),j=x(()=>({createGoal:t=>{const e=l(),r={id:`goal-${crypto.randomUUID()}`,name:t.name,targetAmount:t.targetAmount,targetDate:t.targetDate,description:t.description,status:"active",createdAt:e,updatedAt:e,progress:{totalContributed:0,percentage:0}};return c.setState(s=>({goals:[...s.goals,r]})),r},updateGoal:(t,e)=>{let r;return c.setState(s=>({goals:s.goals.map(o=>{if(o.id!==t)return o;const a={...o,...e,targetAmount:e.targetAmount??o.targetAmount,targetDate:e.targetDate??o.targetDate,description:e.description??o.description,status:e.status??o.status,updatedAt:l()},i=f(s.contributions,t);return a.progress=p(a,i),r=a,a})})),r},addContribution:(t,e)=>{const r=l(),s={id:`contribution-${crypto.randomUUID()}`,goalId:t,amount:e.amount,date:e.date,note:e.note,transactionId:e.transactionId,createdAt:r,updatedAt:r};return c.setState(n=>{const o=[...n.contributions,s],a=n.goals.map(i=>{if(i.id!==t)return i;const m=p(i,o.filter(u=>u.goalId===t));return{...i,progress:m,updatedAt:l()}});return{contributions:o,goals:a}}),s},resetGoal:(t,e)=>{let r;const s=l();if(c.setState(n=>{const o=n.contributions.filter(u=>u.goalId!==t),a=n.contributions.filter(u=>u.goalId===t),i=n.goals.map(u=>{if(u.id!==t)return u;const b={...u,resetAt:s,updatedAt:s,progress:{totalContributed:0,percentage:0}};return r=b,b}),m=[{id:`audit-${crypto.randomUUID()}`,action:"resetGoal",details:{goalId:t,reason:e==null?void 0:e.reason,clearedContributionIds:a.map(u=>u.id)},timestamp:s},...n.auditLog];return{contributions:o,goals:i,auditLog:m}}),!r)throw new Error(`Goal ${t} not found`);return r},reset:()=>{c.setState({goals:[],contributions:[],auditLog:[]})}}));export{w as R,A as b,j as u};
